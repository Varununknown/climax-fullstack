<!DOCTYPE html>
<html>
<head>
    <title>Climax OTT - Database Seeder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: #0f3460;
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid #e94560;
        }
        h1 {
            color: #e94560;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #a8dadc;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .status {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #e94560;
            color: #fff;
            min-height: 60px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        .status.success {
            border-left-color: #06d6a0;
            background: rgba(6, 214, 160, 0.1);
            color: #06d6a0;
        }
        .status.error {
            border-left-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
            color: #ff4757;
        }
        .status.info {
            border-left-color: #4dabf7;
            background: rgba(77, 171, 247, 0.1);
            color: #4dabf7;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-seed {
            background: linear-gradient(135deg, #06d6a0 0%, #00b896 100%);
            color: white;
        }
        .btn-seed:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(6, 214, 160, 0.3);
        }
        .btn-seed:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .btn-check {
            background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
            color: white;
        }
        .btn-check:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(77, 171, 247, 0.3);
        }
        .btn-check:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .log {
            background: #1a1a2e;
            border-radius: 6px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            color: #a8dadc;
            margin-top: 20px;
            border: 1px solid #333;
        }
        .log-entry {
            margin: 4px 0;
            padding: 4px 0;
        }
        .log-entry.success { color: #06d6a0; }
        .log-entry.error { color: #ff4757; }
        .log-entry.info { color: #4dabf7; }
        .info-box {
            background: rgba(77, 171, 247, 0.1);
            border: 1px solid #4dabf7;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            color: #a8dadc;
            line-height: 1.6;
        }
        .info-box strong {
            color: #4dabf7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŒ± Climax OTT Seeder</h1>
        <p class="subtitle">Database initialization tool</p>
        
        <div id="status" class="status info">
            Ready to seed database
        </div>
        
        <div class="button-group">
            <button class="btn-seed" id="seedBtn" onclick="seedDatabase()">
                ðŸŒ± Seed Database
            </button>
            <button class="btn-check" id="checkBtn" onclick="checkStatus()">
                âœ“ Check Status
            </button>
        </div>
        
        <div class="log" id="log"></div>
        
        <div class="info-box">
            <strong>What this does:</strong><br>
            âœ“ Adds 6 sample content items<br>
            âœ“ Populates your database<br>
            âœ“ Enables content editing<br>
            âœ“ Checks backend connectivity
        </div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');
        const seedBtn = document.getElementById('seedBtn');
        const checkBtn = document.getElementById('checkBtn');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function setStatus(message, type = 'info') {
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        async function seedDatabase() {
            seedBtn.disabled = true;
            checkBtn.disabled = true;
            logEl.innerHTML = '';
            
            setStatus('ðŸŒ± Seeding database...', 'info');
            log('Starting seed operation...', 'info');
            
            try {
                log('Connecting to backend...', 'info');
                
                const response = await fetch('https://climax-fullstack.onrender.com/api/contents/seed', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log(`âœ… Success! Added ${data.count} items`, 'success');
                    log(`Message: ${data.message}`, 'success');
                    setStatus(`âœ… Seeding successful! ${data.count} items added. Reloading...`, 'success');
                    
                    setTimeout(() => {
                        log('Reloading page...', 'info');
                        window.location.href = 'https://climax-fullstack.onrender.com/admin';
                    }, 2000);
                } else {
                    log(`âŒ Seed failed (Status: ${response.status})`, 'error');
                    log(`Error: ${data.message || data.error || 'Unknown error'}`, 'error');
                    setStatus(`âŒ Seed failed: ${data.message || 'Unknown error'}`, 'error');
                    
                    seedBtn.disabled = false;
                    checkBtn.disabled = false;
                }
            } catch (error) {
                log(`âŒ Network error: ${error.message}`, 'error');
                setStatus(`âŒ Error: ${error.message}`, 'error');
                
                seedBtn.disabled = false;
                checkBtn.disabled = false;
            }
        }

        async function checkStatus() {
            checkBtn.disabled = true;
            logEl.innerHTML = '';
            
            setStatus('ðŸ” Checking backend status...', 'info');
            log('Checking backend connectivity...', 'info');
            
            try {
                // Check health
                const healthResponse = await fetch('https://climax-fullstack.onrender.com/api/health');
                const healthData = await healthResponse.json();
                
                if (healthResponse.ok) {
                    log(`âœ… Backend: Connected`, 'success');
                    log(`Database: ${healthData.mongo === 'connected' ? 'âœ… Connected' : 'âŒ Disconnected'}`, healthData.mongo === 'connected' ? 'success' : 'error');
                } else {
                    log(`âŒ Backend: Unreachable`, 'error');
                }
                
                // Check contents
                const contentsResponse = await fetch('https://climax-fullstack.onrender.com/api/contents');
                const contentsData = await contentsResponse.json();
                
                if (contentsResponse.ok) {
                    const count = Array.isArray(contentsData) ? contentsData.length : 0;
                    log(`ðŸ“Š Database contents: ${count} items`, count > 0 ? 'success' : 'info');
                    
                    if (count === 0) {
                        log('Database is empty - you need to seed it', 'info');
                        setStatus('Database is empty. Click "Seed Database" to add content.', 'info');
                    } else {
                        log(`Great! You have ${count} items. You can now edit content!`, 'success');
                        setStatus(`âœ… Database has ${count} items. You can edit content now!`, 'success');
                    }
                } else {
                    log(`âŒ Could not fetch contents`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Error: ${error.message}`, 'error');
                setStatus(`âŒ Error: ${error.message}`, 'error');
            }
            
            checkBtn.disabled = false;
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(checkStatus, 500);
        });
    </script>
</body>
</html>
